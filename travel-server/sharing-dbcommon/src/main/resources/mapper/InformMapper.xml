<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="qingning.dbcommon.mybatis.persistence.InformMapper" >
	<!-- 获取通知消息 -->
  <select id="getInformByInformType" resultType="hashmap" parameterType="hashmap" >
    select 
	<if test="inform_type==0">
		title,content,
	</if>
	<if test="inform_type==1">
		course_name,nick_name,balance,income,from_type,
	</if>
	create_time,position from t_inform where inform_type=#{inform_type}
	<if test="inform_type==1">
		and user_id=#{user_id}
	</if>
	<if test="position != null and position > 0">
		and position <![CDATA[ < ]]> #{position} 
	</if>
  	order by position desc limit #{page_count}
  </select>

	<insert id="insertInform" parameterType="hashmap" >
		insert into t_inform
		<trim prefix="(" suffix=")" suffixOverrides="," >
			<if test="inform_id != null" >
				inform_id,
			</if>
			<if test="inform_type != null" >
				inform_type,
			</if>
			<if test="from_type != null" >
				from_type,
			</if>
			<if test="user_id != null" >
				user_id,
			</if>
			<if test="income != null" >
				income,
			</if>
			<if test="course_name != null" >
				course_name,
			</if>
			<if test="balance != null" >
				balance,
			</if>
			<if test="nick_name != null" >
				nick_name,
			</if>
			<if test="title != null" >
				title,
			</if>
			<if test="content != null" >
				content,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides="," >
			<if test="inform_id != null" >
				#{inform_id},
			</if>
			<if test="inform_type != null" >
				#{inform_type},
			</if>
			<if test="from_type != null" >
				#{from_type},
			</if>
			<if test="user_id != null" >
				#{user_id},
			</if>
			<if test="income != null" >
				#{income},
			</if>
			<if test="course_name != null" >
				#{course_name},
			</if>
			<if test="balance != null" >
				#{balance},
			</if>
			<if test="nick_name != null" >
				#{nick_name},
			</if>
			<if test="title != null" >
				#{title},
			</if>
			<if test="content != null" >
				#{content},
			</if>
		</trim>
	</insert>
  
	<!-- 根据position和消息类型获取最新的消息条目数量 -->
	<select id="selectCountByTypeAndPosition" parameterType="hashmap" resultType="int">
		select COUNT(inform_id) 
		from t_inform where inform_type = #{inform_type}
			and position <![CDATA[ > ]]> #{position}
		<if test="inform_type == 1">
			and user_id = #{user_id}
		</if>
	</select>
</mapper>